<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Crypto Blog</title>
    <!-- Include marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Include highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <!-- Include Gemini API -->
    <script src="https://www.googleapis.com/api/js?key=AIzaSyDsUgnBLdtJzl2sQXqb_RnmARlQwP0gDxo&client=google-gemini-api"></script>
    <style>
        :root {
            --primary-color: #0052ff;
            --primary-hover: #0a46e4;
            --text-color: #e5e7eb;
            --text-light: #9ca3af;
            --bg-color: #0f1c39;
            --card-bg: #1b2d57;
            --border-color: #2d4386;
            --success-color: #05b169;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --header-bg: #0a1433;
            --header-text: #f5f6fa;
            --transition-speed: 0.3s;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            --radius: 0.5rem;
        }
        
        [data-theme="dark"] {
            --primary-color: #0052ff;
            --primary-hover: #0a46e4;
            --text-color: #e5e7eb;
            --text-light: #9ca3af;
            --bg-color: #0f1c39;
            --card-bg: #1b2d57;
            --border-color: #2d4386;
            --success-color: #05b169;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --header-bg: #0a1433;
            --header-text: #f5f6fa;
        }
        
        [data-theme="light"] {
            --primary-color: #0052ff;
            --primary-hover: #0a46e4;
            --text-color: #0f1c39;
            --text-light: #5b616e;
            --bg-color: #f7f8fa;
            --card-bg: white;
            --border-color: #e5e9ef;
            --success-color: #05b169;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --header-bg: #0052ff;
            --header-text: white;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        
        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        nav {
            display: flex;
            gap: 1rem;
        }
        
        nav a {
            color: var(--header-text);
            text-decoration: none;
            padding: 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
            position: relative;
        }
        
        nav a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            width: 0;
            height: 2px;
            background-color: var(--primary-color);
            transform: translateX(-50%);
            transition: width 0.2s;
        }
        
        nav a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        nav a:hover::after {
            width: 50%;
        }
        
        nav a.active {
            color: var(--primary-color);
            font-weight: 500;
        }
        
        nav a.active::after {
            width: 70%;
        }
        
        .theme-switch {
            background: none;
            border: none;
            color: var(--header-text);
            font-size: 1.5rem;
            cursor: pointer;
            margin-left: 1rem;
        }
        
        h1, h2, h3 {
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 1rem;
        }
        
        h1 {
            font-size: 2rem;
        }
        
        h2 {
            font-size: 1.5rem;
            margin-top: 1.5rem;
            position: relative;
            display: inline-block;
        }
        
        h2::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -5px;
            width: 40px;
            height: 3px;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }
        
        h2:hover::after {
            width: 100%;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        input, textarea, button, select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.375rem;
            border: 1px solid var(--border-color);
            font-family: inherit;
            font-size: 1rem;
            background-color: var(--card-bg);
            color: var(--text-color);
            box-sizing: border-box;
            transition: border-color 0.2s ease;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
            line-height: 1.6;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.25s cubic-bezier(0.2, 0, 0.2, 1);
            margin-top: 1rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            border-radius: 0.375rem;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120%;
            height: 120%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%);
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
            transition: transform 0.5s ease, opacity 0.3s ease;
        }
        
        button:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
        }
        
        button:hover::before {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 82, 255, 0.2);
        }
        
        button:disabled {
            background-color: #93c5fd;
            cursor: not-allowed;
            transform: none;
        }

        button.btn-danger {
            background-color: var(--error-color);
        }

        button.btn-danger:hover {
            background-color: #b91c1c;
        }

        button.btn-warning {
            background-color: var(--warning-color);
        }

        button.btn-warning:hover {
            background-color: #d97706;
        }
        
        .alert {
            padding: 0.875rem;
            border-radius: 0.375rem;
            margin: 1rem 0;
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .alert-success {
            background-color: #d1fae5;
            border: 1px solid #a7f3d0;
            color: #047857;
        }
        
        .alert-error {
            background-color: #fee2e2;
            border: 1px solid #fecaca;
            color: #b91c1c;
        }

        .alert-warning {
            background-color: #fef3c7;
            border: 1px solid #fde68a;
            color: #b45309;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem 0;
            color: var(--text-light);
            position: relative;
        }
        
        .loading::after {
            content: '';
            display: inline-block;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            animation: spin 1s cubic-bezier(0.5, 0.1, 0.5, 0.9) infinite;
            margin-left: 0.5rem;
            vertical-align: middle;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Admin Table Styles */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .admin-table th, .admin-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .admin-table th {
            font-weight: 600;
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .admin-table tr:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }
        
        .admin-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .admin-actions button {
            margin-top: 0;
            padding: 0.5rem;
            width: auto;
        }
        
        .truncate {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }
        
        .no-articles {
            text-align: center;
            padding: 3rem 0;
            color: var(--text-light);
            font-style: italic;
        }
        
        /* Modal Styles */
        #editModal, #deleteModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: var(--card-bg);
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: var(--shadow);
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-light);
        }
        
        .modal-body {
            margin-top: 1rem;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .modal-footer button {
            margin-top: 0;
        }
        
        footer {
            background-color: var(--card-bg);
            color: var(--text-light);
            padding: 1.5rem 0;
            margin-top: 3rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }
        
        footer a {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        footer a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 640px) {
            header .container {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            nav {
                width: 100%;
                justify-content: space-between;
            }
            
            .modal-content {
                margin: 1rem;
                padding: 1rem;
            }
            
            .admin-table {
                display: block;
                overflow-x: auto;
            }
            
            .admin-actions {
                flex-direction: column;
            }
        }
        
        .category-tag {
            display: inline-flex;
            align-items: center;
            background-color: rgba(0, 82, 255, 0.1);
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 0.875rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .category-tag:hover {
            background-color: rgba(0, 82, 255, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 82, 255, 0.15);
        }
        
        /* Add icons to category tags */
        .category-tag[data-category="Bitcoin"]::before {
            content: '₿';
            margin-right: 4px;
            font-size: 0.8em;
        }
        
        .category-tag[data-category="Ethereum"]::before {
            content: 'Ξ';
            margin-right: 4px;
            font-size: 0.8em;
        }
        
        .category-tag[data-category="DeFi"]::before {
            content: '💹';
            margin-right: 4px;
            font-size: 0.8em;
        }
        
        .category-tag[data-category="NFTs"]::before {
            content: '🖼️';
            margin-right: 4px;
            font-size: 0.8em;
        }
        
        .category-tag[data-category="Market Analysis"]::before {
            content: '📊';
            margin-right: 4px;
            font-size: 0.8em;
        }
        
        /* Scroll to top button */
        .scroll-top-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary-color);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 99;
        }
        
        .scroll-top-btn.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .scroll-top-btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-3px);
        }
        
        .scroll-top-btn::before {
            content: "↑";
            font-size: 1.2rem;
        }
        
        .ai-suggest-btn {
            background-color: #10B981;
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            transition: background-color var(--transition-speed);
        }
        
        .ai-suggest-btn:hover {
            background-color: #059669;
        }
        
        .ai-suggest-btn i {
            font-size: 1rem;
        }
        
        .ai-prompt-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: auto;
        }
        
        .ai-prompt-content {
            background-color: var(--card-bg);
            margin: 2rem auto;
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 600px;
            width: 90%;
            box-shadow: var(--shadow-hover);
            position: relative;
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        
        .ai-prompt-content h3 {
            margin-bottom: 1rem;
        }
        
        .ai-loading {
            display: none;
            text-align: center;
            margin: 1rem 0;
        }
        
        .ai-loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 0.75rem;
        }
        
        .progress-container {
            width: 100%;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: var(--radius-full);
            margin: 0.75rem 0;
            overflow: hidden;
            height: 8px;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: var(--radius-full);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <span class="crypto-icon">Crypto</span>
                <h1>Crypto Blog Admin</h1>
            </div>
            <div style="display: flex; align-items: center;">
                <nav>
                    <a href="index.html">Home</a>
                    <a href="admin.html" class="active">Admin</a>
                </nav>
                <button class="theme-switch" id="themeToggle">🌙</button>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="card">
            <h2>Add New Crypto Article</h2>
            <div class="crypto-categories">
                <span class="category-tag" data-category="Bitcoin">Bitcoin</span>
                <span class="category-tag" data-category="Ethereum">Ethereum</span>
                <span class="category-tag" data-category="DeFi">DeFi</span>
                <span class="category-tag" data-category="NFTs">NFTs</span>
                <span class="category-tag" data-category="Market Analysis">Market Analysis</span>
            </div>
            <form id="postForm">
                <div class="form-group">
                    <label for="title">Title</label>
                    <input type="text" id="title" name="title" placeholder="Enter your crypto article title" required>
                </div>
                
                <div class="form-group">
                    <label for="content">Content (Markdown)</label>
                    <textarea id="content" name="content" placeholder="# Bitcoin Analysis&#10;&#10;Today we're looking at **Bitcoin's** market performance and future predictions.&#10;&#10;## Key Points&#10;&#10;- Bitcoin reached a new resistance level&#10;- Ethereum showed strong correlation&#10;- DeFi projects continue to grow&#10;&#10;```&#10;// Example code for blockchain interaction&#10;const tx = await contract.transfer(recipient, amount);&#10;```" required></textarea>
                </div>
                
                <button type="submit" id="publishBtn">Publish Article <span class="btn-icon">📝</span></button>
            </form>
            
            <div id="successAlert" class="alert alert-success">
                Article published successfully!
            </div>
            
            <div id="errorAlert" class="alert alert-error">
                Error publishing article. Please try again.
            </div>
            
            <div id="publishingLoading" class="loading">
                Publishing...
            </div>
        </div>
        
        <div class="card">
            <h2>Manage Articles</h2>
            <p>View, edit, and delete your blog articles here.</p>
            
            <div id="adminAlerts">
                <div id="successAlert" class="alert alert-success">
                    Operation completed successfully!
                </div>
                
                <div id="errorAlert" class="alert alert-error">
                    An error occurred. Please try again.
                </div>
            </div>
            
            <div id="loadingArticles" class="loading">Loading articles...</div>
            
            <div id="articlesTableContainer">
                <table id="articlesTable" class="admin-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Preview</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="articlesTableBody">
                        <!-- Articles will be loaded here -->
                    </tbody>
                </table>
            </div>
            
            <div id="noArticlesMessage" class="no-articles" style="display: none;">
                No articles found. <a href="index.html">Create your first article</a>.
            </div>
        </div>
        
        <!-- Create New Article Button -->
        <div style="text-align: center;">
            <a href="index.html">
                <button>Create New Article</button>
            </a>
        </div>
    </div>
    
    <!-- Edit Modal -->
    <div id="editModal">
        <div class="modal-content">
            <button class="close-modal" id="closeEditModal">&times;</button>
            <h2>Edit Article</h2>
            
            <div id="editAlerts">
                <div id="editSuccessAlert" class="alert alert-success">
                    Article updated successfully!
                </div>
                
                <div id="editErrorAlert" class="alert alert-error">
                    Error updating article. Please try again.
                </div>
            </div>
            
            <form id="editForm" class="modal-body">
                <input type="hidden" id="editArticleId">
                
                <div class="form-group">
                    <label for="editTitle">Title</label>
                    <input type="text" id="editTitle" name="editTitle" required>
                </div>
                
                <div class="form-group">
                    <label for="editContent">Content (Markdown)</label>
                    <textarea id="editContent" name="editContent" required></textarea>
                </div>
                
                <div class="modal-footer">
                    <button type="button" id="cancelEditButton">Cancel</button>
                    <button type="submit" id="saveEditButton">Save Changes</button>
                </div>
            </form>
            
            <div id="editLoading" class="loading">Saving changes...</div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="deleteModal">
        <div class="modal-content">
            <button class="close-modal" id="closeDeleteModal">&times;</button>
            <h2>Delete Article</h2>
            
            <div class="modal-body">
                <p>Are you sure you want to delete "<span id="deleteArticleTitle"></span>"?</p>
                <p class="alert alert-warning" style="display: block;">
                    This action cannot be undone.
                </p>
                
                <div id="deleteAlerts">
                    <div id="deleteSuccessAlert" class="alert alert-success">
                        Article deleted successfully!
                    </div>
                    
                    <div id="deleteErrorAlert" class="alert alert-error">
                        Error deleting article. Please try again.
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" id="cancelDeleteButton">Cancel</button>
                    <button type="button" id="confirmDeleteButton" class="btn-danger">Delete</button>
                </div>
                
                <div id="deleteLoading" class="loading">Deleting article...</div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>Crypto Blog powered by <a href="https://supabase.com" target="_blank">Supabase</a> | <a href="index.html">Home</a> | <a href="admin.html">Admin</a></p>
        </div>
    </footer>
    
    <!-- Scroll to top button -->
    <button id="scrollTopBtn" class="scroll-top-btn" aria-label="Scroll to top">
        <!-- Arrow symbol added via CSS -->
    </button>
    
    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://nyvceshwodvfhsezjttr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55dmNlc2h3b2R2ZmhzZXpqdHRyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI2NDYxMzMsImV4cCI6MjA1ODIyMjEzM30.ZaLIw7AMh392QrfaG3HNY9sh2e35TwugrMzSUFo3-sM';
        
        // DOM Elements
        const articlesTableBody = document.getElementById('articlesTableBody');
        const loadingArticles = document.getElementById('loadingArticles');
        const noArticlesMessage = document.getElementById('noArticlesMessage');
        const articlesTableContainer = document.getElementById('articlesTableContainer');
        const themeToggle = document.getElementById('themeToggle');
        
        // Alerts
        const successAlert = document.getElementById('successAlert');
        const errorAlert = document.getElementById('errorAlert');
        const editSuccessAlert = document.getElementById('editSuccessAlert');
        const editErrorAlert = document.getElementById('editErrorAlert');
        const deleteSuccessAlert = document.getElementById('deleteSuccessAlert');
        const deleteErrorAlert = document.getElementById('deleteErrorAlert');
        
        // Edit Modal
        const editModal = document.getElementById('editModal');
        const editForm = document.getElementById('editForm');
        const editArticleId = document.getElementById('editArticleId');
        const editTitle = document.getElementById('editTitle');
        const editContent = document.getElementById('editContent');
        const closeEditModal = document.getElementById('closeEditModal');
        const cancelEditButton = document.getElementById('cancelEditButton');
        const saveEditButton = document.getElementById('saveEditButton');
        const editLoading = document.getElementById('editLoading');
        
        // Delete Modal
        const deleteModal = document.getElementById('deleteModal');
        const deleteArticleTitle = document.getElementById('deleteArticleTitle');
        const closeDeleteModal = document.getElementById('closeDeleteModal');
        const cancelDeleteButton = document.getElementById('cancelDeleteButton');
        const confirmDeleteButton = document.getElementById('confirmDeleteButton');
        const deleteLoading = document.getElementById('deleteLoading');
        
        let currentArticleId = null;
        
        // Theme toggle
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            themeToggle.textContent = newTheme === 'dark' ? '🌙' : '☀️';
        });
        
        // Set initial theme based on localStorage or user preference
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize marked.js with proper configuration
            marked.setOptions({
                headerIds: true,
                headerPrefix: 'section-',
                mangle: false,
                breaks: true,
                gfm: true,
                highlight: function(code, lang) {
                    if (lang && hljs.getLanguage(lang)) {
                        return hljs.highlight(code, { language: lang }).value;
                    }
                    return hljs.highlightAuto(code).value;
                }
            });
            
            // Fetch articles on page load
            await fetchAllArticles();
            
            // Set default theme from localStorage or system preference
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (prefersDark ? 'dark' : 'light');
            
            document.documentElement.setAttribute('data-theme', theme);
            themeToggle.textContent = theme === 'dark' ? '🌙' : '☀️';
        });
        
        // ======= Modal Events ========
        
        // Edit Modal
        closeEditModal.addEventListener('click', () => {
            editModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
        
        cancelEditButton.addEventListener('click', () => {
            editModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
        
        // Delete Modal
        closeDeleteModal.addEventListener('click', () => {
            deleteModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
        
        cancelDeleteButton.addEventListener('click', () => {
            deleteModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
        
        // Close modals when clicking outside
        window.addEventListener('click', (event) => {
            if (event.target === editModal) {
                editModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
            if (event.target === deleteModal) {
                deleteModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });
        
        // ======= Form Submissions ========
        
        // Edit form submission
        editForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            // Hide alerts
            hideAlerts('edit');
            
            // Get form data
            const id = editArticleId.value;
            const title = editTitle.value.trim();
            const content = editContent.value.trim();
            
            // Validate inputs
            if (!title || !content) {
                editErrorAlert.textContent = 'Please fill in both title and content fields.';
                editErrorAlert.style.display = 'block';
                return;
            }
            
            // Show loading, disable button
            editLoading.style.display = 'block';
            saveEditButton.disabled = true;
            
            try {
                // Update article in Supabase
                const response = await fetch(`${SUPABASE_URL}/rest/v1/blog?id=eq.${id}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        title,
                        content
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to update article');
                }
                
                // Show success message
                editSuccessAlert.style.display = 'block';
                
                // Close modal after 1.5 seconds
                setTimeout(() => {
                    editModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                    
                    // Refresh the article list
                    fetchAllArticles();
                }, 1500);
                
            } catch (error) {
                console.error('Error:', error);
                editErrorAlert.textContent = error.message || 'Error updating article. Please try again.';
                editErrorAlert.style.display = 'block';
            } finally {
                // Hide loading, enable button
                editLoading.style.display = 'none';
                saveEditButton.disabled = false;
            }
        });
        
        // Delete confirmation
        confirmDeleteButton.addEventListener('click', async () => {
            // Hide alerts
            hideAlerts('delete');
            
            // Show loading, disable button
            deleteLoading.style.display = 'block';
            confirmDeleteButton.disabled = true;
            
            try {
                // Delete article from Supabase
                const response = await fetch(`${SUPABASE_URL}/rest/v1/blog?id=eq.${currentArticleId}`, {
                    method: 'DELETE',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to delete article');
                }
                
                // Show success message
                deleteSuccessAlert.style.display = 'block';
                
                // Close modal after 1.5 seconds
                setTimeout(() => {
                    deleteModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                    
                    // Refresh the article list
                    fetchAllArticles();
                }, 1500);
                
            } catch (error) {
                console.error('Error:', error);
                deleteErrorAlert.textContent = error.message || 'Error deleting article. Please try again.';
                deleteErrorAlert.style.display = 'block';
            } finally {
                // Hide loading, enable button
                deleteLoading.style.display = 'none';
                confirmDeleteButton.disabled = false;
            }
        });
        
        // ======= Utility Functions ========
        
        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString(undefined, { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            });
        }
        
        // Create a preview of the article content
        function createContentPreview(content, maxLength = 100) {
            // Remove markdown formatting for the preview
            let plainText = content
                .replace(/#+\s(.*)/g, '$1') // Remove headers
                .replace(/\*\*(.*)\*\*/g, '$1') // Remove bold
                .replace(/\*(.*)\*/g, '$1') // Remove italic
                .replace(/\[(.*)\]\(.*\)/g, '$1') // Remove links
                .replace(/```[\s\S]*?```/g, '') // Remove code blocks
                .replace(/`(.*)`/g, '$1') // Remove inline code
                .replace(/!\[(.*)\]\(.*\)/g, '[Image: $1]') // Replace images
                .trim();
            
            if (plainText.length > maxLength) {
                return plainText.substring(0, maxLength) + '...';
            }
            
            return plainText;
        }
        
        // Hide alert messages
        function hideAlerts(section = 'main') {
            if (section === 'main' || section === 'all') {
                successAlert.style.display = 'none';
                errorAlert.style.display = 'none';
            }
            
            if (section === 'edit' || section === 'all') {
                editSuccessAlert.style.display = 'none';
                editErrorAlert.style.display = 'none';
            }
            
            if (section === 'delete' || section === 'all') {
                deleteSuccessAlert.style.display = 'none';
                deleteErrorAlert.style.display = 'none';
            }
        }
        
        // Open edit modal with article data
        function openEditModal(article) {
            // Set form values
            editArticleId.value = article.id;
            editTitle.value = article.title;
            editContent.value = article.content;
            
            // Clear any previous alerts
            hideAlerts('edit');
            
            // Show modal
            editModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        // Open delete confirmation modal
        function openDeleteModal(article) {
            // Set article info
            currentArticleId = article.id;
            deleteArticleTitle.textContent = article.title;
            
            // Clear any previous alerts
            hideAlerts('delete');
            
            // Show modal
            deleteModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        // ======= Main Functions ========
        
        // Fetch all articles from Supabase
        async function fetchAllArticles() {
            // Show loading
            loadingArticles.style.display = 'block';
            articlesTableContainer.style.display = 'none';
            noArticlesMessage.style.display = 'none';
            
            try {
                // Fetch articles from Supabase
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/blog?order=created_at.desc`, {
                    method: 'GET',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch articles');
                }
                
                const articles = await response.json();
                
                if (articles.length === 0) {
                    noArticlesMessage.style.display = 'block';
                    return;
                }
                
                // Clear the table body
                articlesTableBody.innerHTML = '';
                
                // Populate the table
                articles.forEach(article => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${article.title}</td>
                        <td class="truncate">${createContentPreview(article.content)}</td>
                        <td>${formatDate(article.created_at)}</td>
                        <td>
                            <div class="admin-actions">
                                <button class="btn-edit" data-id="${article.id}">Edit</button>
                                <button class="btn-delete btn-danger" data-id="${article.id}">Delete</button>
                            </div>
                        </td>
                    `;
                    
                    articlesTableBody.appendChild(row);
                });
                
                // Add event listeners to buttons
                document.querySelectorAll('.btn-edit').forEach(button => {
                    button.addEventListener('click', async () => {
                        const id = button.getAttribute('data-id');
                        const article = articles.find(a => a.id == id);
                        openEditModal(article);
                    });
                });
                
                document.querySelectorAll('.btn-delete').forEach(button => {
                    button.addEventListener('click', () => {
                        const id = button.getAttribute('data-id');
                        const article = articles.find(a => a.id == id);
                        openDeleteModal(article);
                    });
                });
                
                // Show the table
                articlesTableContainer.style.display = 'block';
                
            } catch (error) {
                console.error('Error:', error);
                errorAlert.textContent = error.message || 'Error loading articles. Please try again.';
                errorAlert.style.display = 'block';
            } finally {
                // Hide loading
                loadingArticles.style.display = 'none';
            }
        }

        // Add event listeners for the publish form
        const postForm = document.getElementById('postForm');
        const publishBtn = document.getElementById('publishBtn');
        const publishingLoading = document.getElementById('publishingLoading');
        
        // Post form submission
        postForm.addEventListener('submit', handleFormSubmit);

        // Function to handle form submission
        async function handleFormSubmit(event) {
            event.preventDefault();
            
            // Hide any previously shown alerts
            successAlert.style.display = 'none';
            errorAlert.style.display = 'none';
            
            // Get form data
            const title = document.getElementById('title').value.trim();
            const content = document.getElementById('content').value.trim();
            
            // Validate inputs
            if (!title || !content) {
                errorAlert.textContent = 'Please fill in both title and content fields.';
                errorAlert.style.display = 'block';
                return;
            }
            
            // Show loading and disable button
            publishingLoading.style.display = 'block';
            publishBtn.disabled = true;
            
            // Create post object with current timestamp
            const post = {
                title,
                content,
                created_at: new Date().toISOString()
            };
            
            try {
                // Send POST request to Supabase
                const response = await fetch(`${SUPABASE_URL}/rest/v1/blog`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(post)
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('Supabase response:', response.status, errorData);
                    
                    let errorMessage = `Error (${response.status}): `;
                    
                    if (response.status === 404) {
                        errorMessage += "Table 'blog' not found. Please create the table in Supabase.";
                    } else if (response.status === 401) {
                        errorMessage += "Authentication failed. Check your Supabase anon key.";
                    } else if (response.status === 403) {
                        errorMessage += "Permission denied. Enable RLS policies for inserts on the 'blog' table.";
                    } else if (errorData.message) {
                        errorMessage += errorData.message;
                    } else {
                        errorMessage += "Failed to publish article. See console for details.";
                    }
                    
                    throw new Error(errorMessage);
                }
                
                // Show success message and reset form
                successAlert.style.display = 'block';
                postForm.reset();
                
                // Hide success message after 3 seconds
                setTimeout(() => {
                    successAlert.style.display = 'none';
                }, 3000);
                
                // Refresh the article list
                fetchAllArticles();
                
            } catch (error) {
                console.error('Error:', error);
                errorAlert.textContent = error.message || 'Error publishing article. Please try again.';
                errorAlert.style.display = 'block';
            } finally {
                // Hide loading and enable button
                publishingLoading.style.display = 'none';
                publishBtn.disabled = false;
            }
        }

        // Scroll to top functionality
        const scrollTopBtn = document.getElementById('scrollTopBtn');
        
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                scrollTopBtn.classList.add('visible');
            } else {
                scrollTopBtn.classList.remove('visible');
            }
        });
        
        scrollTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Initialize Gemini API
        const GEMINI_API_KEY = 'AIzaSyDsUgnBLdtJzl2sQXqb_RnmARlQwP0gDxo';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1/models/gemini-1.5-pro:generateContent';
        
        // AI Content Generation
        const aiSuggestBtn = document.createElement('button');
        aiSuggestBtn.className = 'ai-suggest-btn';
        aiSuggestBtn.innerHTML = '<i class="fas fa-robot"></i> Generate with AI';
        aiSuggestBtn.type = 'button';
        
        // Add AI suggest button after content textarea
        const contentTextarea = document.getElementById('content');
        contentTextarea.parentNode.insertBefore(aiSuggestBtn, contentTextarea.nextSibling);
        
        // Create AI Prompt Modal
        const aiPromptModal = document.createElement('div');
        aiPromptModal.className = 'ai-prompt-modal';
        aiPromptModal.innerHTML = `
            <div class="ai-prompt-content">
                <h3>Generate Content with AI</h3>
                <div class="form-group">
                    <label for="aiPrompt">Describe what you want to write about:</label>
                    <textarea id="aiPrompt" rows="4" placeholder="E.g., Write an article about the latest trends in cryptocurrency"></textarea>
                </div>
                <div class="ai-loading">
                    <div class="ai-loading-spinner"></div>
                    <p>Generating content...</p>
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <p class="progress-text" id="progressText">0%</p>
                </div>
                <div class="modal-footer">
                    <button type="button" id="aiPromptCancel">Cancel</button>
                    <button type="button" id="aiPromptSubmit">Generate</button>
                </div>
            </div>
        `;
        document.body.appendChild(aiPromptModal);
        
        // AI Modal Controls
        const aiPromptCancelBtn = document.getElementById('aiPromptCancel');
        const aiPromptSubmitBtn = document.getElementById('aiPromptSubmit');
        const aiPromptTextarea = document.getElementById('aiPrompt');
        const aiLoading = document.querySelector('.ai-loading');
        
        aiSuggestBtn.addEventListener('click', () => {
            aiPromptModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            aiPromptTextarea.focus();
        });
        
        aiPromptCancelBtn.addEventListener('click', () => {
            aiPromptModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
        
        aiPromptSubmitBtn.addEventListener('click', async () => {
            const prompt = aiPromptTextarea.value.trim();
            if (!prompt) return;
            
            // Show loading
            aiLoading.style.display = 'block';
            aiPromptSubmitBtn.disabled = true;
            aiPromptCancelBtn.disabled = true;
            
            // Get progress elements
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            // Reset progress
            progressBar.style.width = '0%';
            progressText.textContent = '0%';
            
            // Start progress animation
            let progress = 0;
            const progressInterval = setInterval(() => {
                // Increment progress but slow down as it approaches 90%
                if (progress < 30) {
                    progress += 5;
                } else if (progress < 60) {
                    progress += 3;
                } else if (progress < 85) {
                    progress += 1;
                } else if (progress < 90) {
                    progress += 0.5;
                }
                
                // Cap at 90% until content is actually received
                if (progress > 90) progress = 90;
                
                // Update progress bar and text
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `${Math.round(progress)}%`;
            }, 300);
            
            try {
                const { title, content } = await generateContentWithGemini(prompt);
                
                // Complete progress
                clearInterval(progressInterval);
                progressBar.style.width = '100%';
                progressText.textContent = '100%';
                
                // Wait a moment to show completion
                setTimeout(() => {
                    // Set both title and content
                    document.getElementById('title').value = title;
                    contentTextarea.value = content;
                    
                    // Close modal
                    aiPromptModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }, 500);
            } catch (error) {
                // Stop progress animation
                clearInterval(progressInterval);
                progressBar.style.width = '0%';
                progressText.textContent = 'Failed';
                progressText.style.color = 'var(--error-color)';
                
                console.error('Error generating content:', error);
                let errorMessage = 'Failed to generate content. Please try again.';
                
                // Check for specific error messages
                if (error.message.includes('API error')) {
                    if (error.message.includes('400')) {
                        errorMessage = 'Bad request. Please check your prompt and try again.';
                    } else if (error.message.includes('401') || error.message.includes('403')) {
                        errorMessage = 'API key issue. The Gemini API key may be invalid or has insufficient permissions.';
                    } else if (error.message.includes('429')) {
                        errorMessage = 'Too many requests. Please try again later.';
                    } else if (error.message.includes('5')) {
                        errorMessage = 'Gemini API server error. Please try again later.';
                    }
                }
                
                alert(errorMessage);
            } finally {
                // Ensure loading is hidden even if error occurs
                setTimeout(() => {
                    aiLoading.style.display = 'none';
                    aiPromptSubmitBtn.disabled = false;
                    aiPromptCancelBtn.disabled = false;
                    
                    // Reset progress styles
                    progressText.style.color = 'var(--text-secondary)';
                }, 1000);
            }
        });
        
        async function generateContentWithGemini(prompt) {
            const requestBody = {
                contents: [{
                    parts: [{
                        text: `Generate a complete cryptocurrency blog post about the following topic: ${prompt}.
                              
                              Important requirements:
                              1. First, generate a catchy title with an appropriate emoji/icon at the beginning. The title should be on its own line starting with a single # (Example: "# 💰 The Rise of Bitcoin")
                              2. After the title, write a detailed blog post that is informative, well-structured, and engaging.
                              3. Include a strong introduction, several body paragraphs with key points, and a conclusion.
                              4. Add appropriate emoji/icon before each heading but DO NOT include the ## markdown syntax in the output. Instead use proper heading elements that will render correctly like: <h2>📊 Market Analysis</h2> or use another format that will render as proper headings without showing ## symbols.
                              5. For list items, use emoji instead of bullet points (not both). For example, instead of "• 📈 Price movement", just use "📈 Price movement" without the bullet point.
                              6. Focus on cryptocurrency aspects related to the topic.
                              
                              Note: DO NOT include "## The Future of ZenCard" or any static heading. Generate a completely new title and content based on the prompt.`
                    }]
                }],
                generationConfig: {
                    temperature: 0.7,
                    topK: 40,
                    topP: 0.95,
                    maxOutputTokens: 2048,
                }
            };
            
            try {
                console.log('Sending request to Gemini API:', JSON.stringify(requestBody));
                
                // Use a CORS proxy to avoid CORS issues when running locally
                const corsProxy = 'https://cors-anywhere.herokuapp.com/';
                const apiUrl = `${GEMINI_API_URL}?key=${GEMINI_API_KEY}`;
                
                // Process the response to extract title and content
                const processApiResponse = (responseText) => {
                    const data = JSON.parse(responseText);
                    
                    if (!data.candidates || !data.candidates[0] || !data.candidates[0].content || !data.candidates[0].content.parts || !data.candidates[0].content.parts[0]) {
                        throw new Error('Invalid response format from Gemini API');
                    }
                    
                    const fullText = data.candidates[0].content.parts[0].text;
                    
                    // Split the response to separate title and content
                    // Look for the first line that starts with # which is the title
                    const lines = fullText.split('\n');
                    let title = '';
                    let content = '';
                    
                    // Find the title (first line starting with #)
                    const titleLine = lines.find(line => line.trim().startsWith('# '));
                    
                    if (titleLine) {
                        // Remove the # prefix from the title
                        title = titleLine.trim().substring(2).trim();
                        
                        // Everything else is content
                        content = fullText;
                    } else {
                        // If no title format is found, generate a default title
                        title = `${prompt} Analysis`;
                        content = fullText;
                    }
                    
                    return { title, content };
                };
                
                // Modify the direct API call section to use the processing function
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });
                    
                    // Log response details for debugging
                    console.log('Response status:', response.status);
                    
                    const responseText = await response.text();
                    console.log('Response text:', responseText);
                    
                    if (!response.ok) {
                        throw new Error(`API error (${response.status}): ${responseText}`);
                    }
                    
                    return processApiResponse(responseText);
                } catch (directError) {
                    console.warn('Direct API call failed, trying with CORS proxy:', directError);
                    
                    try {
                        // If direct request fails, try with CORS proxy
                        const proxyResponse = await fetch(corsProxy + apiUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-Requested-With': 'XMLHttpRequest'
                            },
                            body: JSON.stringify(requestBody)
                        });
                        
                        console.log('Proxy response status:', proxyResponse.status);
                        
                        const proxyResponseText = await proxyResponse.text();
                        console.log('Proxy response text:', proxyResponseText);
                        
                        if (!proxyResponse.ok) {
                            throw new Error(`Proxy API error (${proxyResponse.status}): ${proxyResponseText}`);
                        }
                        
                        return processApiResponse(proxyResponseText);
                    } catch (proxyError) {
                        console.warn('Proxy API call also failed, using local fallback:', proxyError);
                        
                        // If all API attempts fail, use a local fallback to generate simple content
                        return generateLocalFallbackContent(prompt);
                    }
                }
            } catch (error) {
                console.error('Detailed error in generateContentWithGemini:', error);
                throw error;
            }
        }
        
        // Local fallback content generator
        function generateLocalFallbackContent(prompt) {
            const topic = prompt.trim();
            const currentDate = new Date().toLocaleDateString();
            
            // Create an object with title and content
            return {
                title: `💡 ${topic} - Cryptocurrency Analysis`,
                content: `# 💡 ${topic} - Cryptocurrency Analysis
            
## 🌟 Introduction

Welcome to our in-depth analysis of ${topic} in the cryptocurrency space. As of ${currentDate}, this topic has gained significant attention among investors, traders, and blockchain enthusiasts. This article aims to provide a comprehensive overview and insights into why ${topic} matters for the crypto ecosystem.

## 📜 Background and Context

${topic} represents an important development in the cryptocurrency market. Recent trends show increasing interest from both institutional and retail investors. Understanding the historical context helps us better analyze current patterns and potential future movements.

## 📊 Key Market Indicators

📈 Market capitalization: The relative size and growth potential related to ${topic}
💹 Trading volume: Recent changes in trading activity around related assets
🏢 Institutional adoption: How major financial players are approaching this area
📋 Regulatory landscape: Current and anticipated regulatory developments

## 📉 Technical Analysis

From a technical perspective, several patterns are emerging that deserve attention. Chart analysis shows support and resistance levels that may influence short to medium-term price movements. Technical indicators suggest potential volatility in the coming weeks.

## 💰 Investment Considerations

When considering ${topic} as part of your investment strategy, balance the potential upside with risk management principles. Diversification remains important, as does staying informed about rapid developments in this space.

## 🔮 Conclusion

${topic} continues to evolve within the cryptocurrency ecosystem. While opportunities exist, thoughtful analysis and careful risk management remain essential. We'll continue tracking developments and providing updates as the situation evolves.

*Note: This content was generated locally as a fallback when the AI service was unavailable. For more detailed crypto analysis, please try again later.*`
            };
        }
        
        // Add Font Awesome for icons
        const fontAwesomeLink = document.createElement('link');
        fontAwesomeLink.rel = 'stylesheet';
        fontAwesomeLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
        document.head.appendChild(fontAwesomeLink);
    </script>
</body>
</html> 